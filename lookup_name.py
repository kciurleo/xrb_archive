import numpy as np
import sys
from astroquery.simbad import Simbad

proper_to_nicknames = {
    'A0620-00': ['A0620-00', 'A0620', 'AO620'],
    'Aql X-1': ['Aql X-1',  'AqlX-1', 'Aql X1', 'AqlX1', 'Aql X-1 r', 'Aql X-1 i', 'Aql X-1 v', 'Aqll X-1'],
    'Cen X-3': ['Cen X-3', 'CenX-3', 'CenX3', 'Cen X3'],
    'Cen X-4': ['Cen X-4', 'CenX-4', 'CenX4', 'Cen X4'],
    'Cir X-1': ['Cir X-1', 'CirX-1', 'CirX1', 'Cir X1'],
    'GRO J1655-40': ['GRO J1655-40', 'GROJ1655-40', 'J1655-40', 'GRO 1655-40'],
    'GRS 1009-45': ['GRS 1009-45', 'GRS1009-45'],
    'GRS 1739-278': ['GRS 1739-278', 'GRS1739-278'],
    'GRS 1716−249': ['GRS 1716−249', 'GRS1716−249', 'GRS1716', 'GRS 1716'],
    'GRS 1915+105': ['GRS 1915+105', 'GRS1915+105', 'GRS1915', 'GRS 1915'],
    'GS 1354-645': ['GS 1354-645', 'GS1354-645'],
    'GX 301-2': ['GX 301-2', 'GX301-2'],
    'GX 1+4': ['GX 1+4', 'GX1+4'],
    'GX 17+2': ['GX 17+2', 'GX17+2'],
    'GX 339-4': ['GX 339-4', 'GX339-4', 'GX339', 'GX 339'],
    'GX 349+2': ['GX 349+2', 'GX349+2'],
    'GX 354-0': ['GX 354-0', 'GX354-0'],
    'GX 9+9': ['GX 9+9', 'GX9+9'],
    'GX 5-1': ['GX 5-1', 'GX5-1'],
    'IGR J17191-2821': ['IGR J17191-2821', 'IGR_J17191-2821', 'IGRJ17191-2821'],
    'IGR J17091-3624': ['IGR J17091-3624', 'IGR_J17091-3624', 'IGRJ17091-3624', 'IGR_J17091', 'IGR J17091', 'J1709'],
    'IGR_J17379-3747': ['IGR J17379-374', 'IGR_J17379-374', 'IGRJ17379-374', 'IGR J17379-3747', 'IGR_J17379-3747', 'IGRJ17379-3747'],
    'J0051-72': ['J0051-72', 'Swift J0051-72'],
    'J0051-736': ['MAXIJ0051-736', 'J0051-736'],
    'J0911' : ['SwiftJ0911', 'Swift J0911', 'Swift_J0911', 'J0911', 'Swift J0911.2+4533'],
    'J11305': ['J11305', 'J11305-6256', 'IGR J11305-6256'],
    'J11435': ['J11435', 'J11435-6109', 'IGR J11435-6109'],
    'J1357': ['J1357', 'J1357.2-0933', 'SwiftJ1357.2-0933', 'Swift J1357.2-0933', 'Swift_J1357.2-0933'],
    'J1535-571': ['J1535-571', 'MAXI J1535-571', 'MAX J1535-571'],
    'J1550-564': ['XTEJ1550-564', 'XTE J1550-564', 'J1550-564', 'J1550', 'XTE J1550'],
    'J1628-41': ['J1628-41', 'VASC J1628-41'],
    'J16283-4838': ['J16283-4838', 'IGR J16283-4838'],
    'J1631-478': ['J1631-478','MAXJ1631-478','MAX J1631-478', 'MAXI J1631-478', 'MAXI J1631-479','J1631-479'],
    'J1659-152': ['J1659-152','MAXI_J1659-152'],
    'J1701-462' : ['J1701-462', 'XTE J1701-462', 'XTEJ1701-462'],
    'J1719-356': ['J171900.4-353217', 'J1719-356', 'XTE J1719-356', 'XTEJ1719-356'],
    'J1720-318': ['J1720-318', 'XTE J1720-318', 'XTEJ1720-318'],
    'J1727-203' : ['J1727-203', 'MAXI J1727-203', 'MAXIJ1727-203'],
    'J1745-26': ['J1745-26', 'SwiftJ1745-26', 'Swift J1745-26', 'Swift_J1745-26'],
    'J1746-322': ['J1746', 'J1746-322', 'XTE J1746-322', 'XTEJ1746-322','J1746-323', 'XTE J1746-323', 'XTEJ1746-323'],
    'J1749.4-2807': ['SwiftJ1749', 'Swift J1749', 'Swift_J1749','J1749', 'J1749.4-2807'],
    'J1752-223': ['JI752-223', 'XTE JI752-223', 'XTEJI752-223', 'J1752-223', 'XTE J1752-223', 'XTEJ1752-223'],
    'J1753': ['SwiftJ1753.5-0127', 'Swift J1753.5-0127', 'Swift_J1753.5-0127', 'J1753.5-0127', 'J1753'],
    'J1808.4-3658': ['J1808.4-3658','SAXJ1808.4-3658','SAX J1808.4-3658','SAX_J1808.4-3658'],
    'J1813-095' : ['J1813-095', 'MAXI J1813-095', 'MAXIJ1813-095'],
    'J1817-330' : ['J1817-33', 'J1817-330', 'XTE J1817-330'],
    'J1818-245': ['J1818-245', 'XTE J1818-245', 'XTEJ1818-245'],
    'J1820': ['J1820', 'J1820+070', 'MAXI J1820+070'],
    'J1828-249':['J1828-249', 'MAXI J1828-249'],
    'J1858.6-0814': ['J1858.6-0814','Swift1858', 'Swift 1858', 'Swift_1858'],
    'J1957+032': ['J1957+032', 'MAXI1957+032', 'MAXI 1957+032'],
    'LMC X-1': ['LMC X-1', 'LMCX-1', 'LMCX1', 'LMC X1'],
    'LMC X-2': ['LMC X-2', 'LMCX-2', 'LMCX2', 'LMC X2'],
    'LMC X-3': ['LMC X-3', 'LMCX-3', 'LMCX3', 'LMC X3'],
    'Nova Musca': ['Nova Musca', 'Nova Musc', 'NovaMusca', 'Nova Musca 1991', 'Nova Musc 1991'],
    'Sco X-1': ['Sco X-1', 'ScoX-1', 'ScoX1', 'Sco X1'],
    'SMC X-1': ['SMCX-1', 'SMC X-1', 'SMCX1', 'SMC X1'],
    'SMC X-2': ['SMCX-2', 'SMC X-2', 'SMCX2', 'SMC X2'],
    'SMC X-3': ['SMCX-3', 'SMC X-3', 'SMCX3', 'SMC X3'],
    'V4641': ['V4641', 'V4641 Sgr'],
    '4U 1254-690': ['4U1254-690', '4U 1254-690'],
    '4U 1538-52': ['4U1538-52', '4U 1538-52'],
    '4U 1543-47': ['4U1543-47', '4U 1543-47','4U1543', '4U 1543'],
    '4U 1543-624': ['4U1543-624', '4U 1543-624'],
    '4U 1608-52': ['4U1608-52', '4U 1608-52'],
    '4U 1630-47': ['4U1630-47', '4U 1630-47', '4U1630-472', '4U 1630-472'],
    '4U 1636-536': ['4U1636-536', '4U 1636-536'],
    '4U 1658-298': ['4U1658-298', '4U 1658-298', 'MXB 1658-298'],
    '4U 1702-429': ['4U1702-429', '4U 1702-429'],
    '4U 1735-444': ['4U1735-444', '4U 1735-444','4U1734-444', '4U 1734-444'],
    '4U 1755-338': ['4U1755-338', '4U 1755-338'],
    '4U 1822-371': ['4U1822-371', '4U 1822-371', '3A1822-371', '3A 1822-371'],
    '4U 1907+097': ['4U1907+097', '4U 1907+097'],

    #are these xrbs
    'wCen-1': ['wCen-1', 'WCen1', 'WCen 1'],
    'wCen-2': ['wCen-2', 'WCen2', 'WCen 2'],

    #fully unknown what these objs are and/or non-XRBs
    'YALE-08A-0001': ['YALE-08A-0001'],
    'New_Transient': ['New_Transient'],
    'Gaia18ajt': ['Gaia18ajt'],
    'GRB181201A': ['GRB181201A'],
    'PERSSON-9104': ['PERSSON-9104'],
    'LANDOLT-TPheD': ['LANDOLT-TPheD'],
    'H0557-385': ['H0557-385'],
    'F+0119': ['F+0119'],
    'NSMC2016': ['NSMC2016'],
    'J0427': ['J0427'],
    'J0658-03': ['J0658-03'], 
    'OB140907': ['OB140907'],
    'J0924': ['J0924', 'CXOJ0924', 'CXO J0924'],

    ###Blazars (or other AGNs); note some may still be the same object
    #less thorough here than for xrbs   
    '3C 120': ['3C120', '3C 120'],
    '3C 271' : ['3C271', '3C 271'],
    '3C 273' : ['3C273', '3C 273'],
    '3C 279' : ['3C279', '3C 279'],
    '3C 446': ['3C446', '3C 446', 'PKS 3C 446', 'PKS3C 446'],
    '3C 454' : ['3C454', '3C 454', '3C454.3', '2C 454.3', '2C454.3'],
    '3C 2379': ['3C2379', '3C 2379'],
    'CRATES J0531': ['CRATES J0531'],
    'CTA 102': ['CTA 102', 'CTA102', 'CT102'],
    'HB89': ['HB89'],
    'J0413-5332': ['J0413-5332', '0413-5332'],
    'J0507-6104': ['J0507-6104', '0507-6104'], 
    'J0850-1213': ['J0850-12','J0850-1213','0850-1213'],
    'J0948+0022': ['J0948+0022', '0948+0022'],  
    'J1833-2103': ['J1833-2103', '1833-2103'],
    'J2331-2148' : ['J2331-2148', '2331-2148'],
    'OJ287': ['OJ287', '0J287'],
    'PKS 0035-252': ['PKS 0035-252', 'PKS0035-252', '0035-252'],
    'PKS 0135-247': ['PKS 0135-247', 'PKS0135-247', '0135-247'],
    'PKS 0402-362': ['PKS 0402-362', 'PKS0402-362', '0402-362', '3~0402-362'],
    'PKS 0403-13': ['PKS 0403-13', 'PKS0403-13', '0403-13'],
    'PKS 0727-11': ['PKS 0727-11', 'PKS0727-11', '0727-11'],
    'PKS 0637-75': ['PKS 0637-75', 'PKS0637-75', '0637-75'],
    'PKS 1508-05': ['PKS 1508-05', 'PKS1508-05', '1508-05'],
    'PKS 1622-297': ['PKS 1622-297', 'PKS1622-297', '1622-297'],
    'PKS 1954-388': ['PKS 1954-388', 'PKS1954-388', '1954-388'],
    'PKS 1958-179': ['PKS 1958-179', 'PKS1958-179', '1958-179'],
    'PKS 2005-489': ['PKS 2005-489', 'PKS2005-489', '2005-489'],
    'PKS 2227-08': ['PKS 2227-08', 'PKS2227-08', '2227-08'],
    'PKS 2232-488': ['PKS 2232-488', 'PKS2232-488', '2232-488'],
    'PKS 2240-260': ['PKS 2240-260', 'PKS2240-260', '2240-260'],
    'PKS 2255-282': ['PKS 2255-282', 'PKS2255-282', '2255-282'],
    'PKS 2326-502': ['PKS 2326-502', 'PKS2326-502', '2326-502', 'PKS2326'],
    'PKS 2345-16': ['PKS 2345-16', 'PKS2345-16', '2345-16'],
    'PKS B1322-110': ['PKS B1322-110', 'PKSB1322-110', 'B1322-110', 'PKS B1322-210'],
    '0017-0512': ['0017-0512'],
    '0106+0119': ['0106+0119'],
    '0130-17': ['0130-17'],
    '0131-522': ['0131-522'],
    '0133-332': ['0133-332'],
    '0206-1150': ['0206-1150'],
    '0208+512': ['0208+512'],
    '0208-512': ['0208-512'],
    '0211+1050': ['0211+1050'],
    '0226-559': ['0226-559'],
    '0235+164': ['0235+164'],
    '0235-518': ['0235-518'],
    '0235-61': ['0235-61'],
    '0235-618': ['0235-618'],
    '0238-3116': ['0238-3116'],
    '0244-470': ['0244-470'],
    '0250-225': ['0250-225'],
    '0250-255': ['0250-255'],
    '0252-549': ['0252-549'],
    '0253-549': ['0253-549'],
    '0301-243': ['0301-243'],
    '0306+101': ['0306+101'],
    '0306+102': ['0306+102'],
    '0316+0904': ['0316+0904'],
    '0336-01': ['0336-01'],
    '0348-2749': ['0348-2749'],
    '0405-385': ['0405-385'],
    '0406-076': ['0406-076'],
    '0417-0250': ['0417-0250'],
    '0422+004': ['0422+004'],
    '0424+0036': ['0424+0036'],
    '0426-380': ['0426-380'],
    '0438-43': ['0438-43'],
    '0440-00': ['0440-00'],
    '0442-00': ['0442-00'],
    '0447-032': ['0447-032'],
    '0454-234': ['0454-234', '.0454-234'],
    '0454-46': ['0454-46', 'PKS 0454-46', 'PKS0454-46'],
    '0458-02': ['0458-02'],
    '0502+049': ['0502+049'],
    '0505+0415': ['0505+0415'],
    '0506+056': ['0506+056'],
    '0514-0459': ['0514-0459'],
    '0514-459': ['0514-459'],
    '0514-4590': ['0514-4590'],
    '0517-726': ['0517-726'],
    '0521-36': ['0521-36'],
    '0528+134': ['0528+134'],
    '0531-4827': ['0531-4827'],
    '0537-286': ['0537-286'],
    '0537-411': ['0537-411'],
    '0537-44': ['0537-44'],
    '0537-441': ['0537-441'],
    '0537-441.': ['0537-441.'],
    '0617-4026': ['0617-4026'],
    '0623-3350': ['0623-3350'],
    '0630-2406': ['0630-2406'],
    '0646-176': ['0646-176'],
    '0730-11': ['0730-11'],
    '0736+01': ['0736+01'],
    '0736-01': ['0736-01'],
    '0805-077': ['0805-077','.0805-077'],
    '0816-1311': ['0816-1311'],
    '0818-128': ['0818-128'],
    '0850-1213': ['0850-1213'],
    '0852-5755': ['0852-5755'],
    '0902-4624': ['0902-4624'],
    '0903-57': ['0903-57'],
    '0943+105': ['0943+105'],
    '1004-217': ['1004-217'],
    '1035-281': ['1035-281'],
    '1038-5311': ['1038-5311'],
    '1055+018': ['1055+018'],
    '1057-6027': ['1057-6027'],
    '1059-1134': ['1059-1134'],
    '1123-6415': ['1123-6415'],
    '1124-186': ['1124-186'],
    '1127-14': ['1127-14'],
    '1142-225': ['1142-225'],
    '1144-379': ['1144-379'],
    '1153-1124': ['1153-1124'],
    '1212+078': ['1212+078'],
    '1219+285': ['1219+285'],
    '1224-41': ['1224-41'],
    '1244-235': ['1244-235'],
    '1244-25': ['1244-25'],
    '1244-255': ['1244-255'],
    '1313-333': ['1313-333'],
    '1329-049': ['1329-049'],
    '1335-127': ['1335-127'],
    '1346-112': ['1346-112'],
    '139391': ['139391'],
    '1406-076': ['1406-076'],
    '1419-08': ['1419-08'],
    '1424+240': ['1424+240'],
    '1424-240': ['1424-240'],
    '1424-41': ['1424-41'],
    '1434-354': ['1434-354'],
    '1439-153': ['1439-153'],
    '1451-375': ['1451-375'],
    '1454-354': ['1454-354'],
    '1502+106': ['1502+106'],
    '1510-089': ['1510-089'],
    '1514-241': ['1514-241'],
    '1515-272': ['1515-272'],
    '1515-273': ['1515-273'],
    '1532+01': ['1532+01'],
    '1532-1319': ['1532-1319'],
    '1534+01': ['1534+01'],
    '1539-153': ['1539-153'],
    '1550-242': ['1550-242'],
    '1553+113': ['1553+113'],
    '1555+113': ['1555+113'],
    '1610-6649': ['1610-6649'],
    '1622-253': ['1622-253'],
    '1626-2646': ['1626-2646'],
    '1632-1052': ['1632-1052'],
    '1703-6212': ['1703-6212'],
    '1717-5156': ['1717-5156'],
    '1730-130': ['1730-130'],
    '1747-5236': ['1747-5236'],
    '1749+096': ['1749+096'],
    '1824-582': ['1824-582'],
    '1830-211': ['1830-211'],
    '1842-582': ['1842-582'],
    '1908-201': ['1908-201'],
    '1913-363': ['1913-363'],
    '1913-3630': ['1913-3630'],
    '1915-458': ['1915-458'],
    '1921-1607': ['1921-1607'],
    '1923+123': ['1923+123'],
    '1923-2104': ['1923-2104'],
    '1931+0938': ['1931+0938'],
    '1945-388': ['1945-388'],
    '2004-217': ['2004-217'],
    '2007-2518': ['2007-2518'],
    '2023-037': ['2023-037'],
    '2023-07': ['2023-07'],
    '2032+1017': ['2032+1017'],
    '2032+107': ['2032+107'],
    '2045-1555': ['2045-1555'],
    '2052-474': ['2052-474'],
    '2052-5333': ['2052-5333'],
    '2052-5533': ['2052-5533'],
    '2055-002': ['2055-002'],
    '2134+004': ['2134+004'],
    '2136-642': ['2136-642'],
    '2141-6411': ['2141-6411'],
    '2142-75': ['2142-75'],
    '2144+092': ['2144+092'],
    '2145-75': ['2145-75'],
    '2149-306': ['2149-306'],
    '2155-304': ['2155-304'],
    '2155-3604': ['2155-3604'],
    '2155-83': ['2155-83'],
    '2211-7039': ['2211-7039'],
    '2233-14': ['2233-14'],
    '2233-148': ['2233-148'],
    '2247-131': ['2247-131'],
    '2250-2806': ['2250-2806'],
    '2251-1239': ['2251-1239'],
    '2301-0157': ['2301-0157'],
    '2316-502': ['2316-502'],
    '2320-035': ['2320-035'],
    '2322-409': ['2322-409'],
    '2333-415': ['2333-415'],
    '2345-155': ['2345-155'],
    '2345-1555': ['2345-1555'],
    '2354-021': ['2354-021'],
    '2356-309': ['2356-309'],

    ###MACHO objects, to be ignored
    'macho310a': ['macho310a'],
    'macho163a': ['macho163a'],
    'macho125a': ['macho125a'],
    'macho310d': ['macho310d'],
    'macho310c': ['macho310c'],
    'macho310e': ['macho310e'],
    'macho306': ['macho306'],
    'macho167b': ['macho167b'],
    'macho162b': ['macho162b'],
    'macho125d': ['macho125d'],
    'macho163b': ['macho163b'],
    'macho161a': ['macho161a'],
    'macho125c': ['macho125c'],
    'macho161b': ['macho161b'],
    'macho162a': ['macho162a'],
    'macho310b': ['macho310b'],
    'macho167a': ['macho167a'],
    'macho168': ['macho168'],
    'macho162c': ['macho162c'],
    'macho125b': ['macho125b'],
    'mach310a': ['mach310a'],
}

xrb_list = ['A0620-00', 'Aql X-1', 'Cen X-3', 'Cen X-4', 'Cir X-1', 'GRO J1655-40', 'GRS 1009-45', 
            'GRS 1739-278', 'GRS 1716−249', 'GRS 1915+105', 'GS 1354-645', 'GX 301-2', 'GX 1+4', 
            'GX 17+2', 'GX 339-4', 'GX 349+2', 'GX 354-0', 'GX 9+9', 'GX 5-1', 'IGR J17191-2821', 
            'IGR J17091-3624', 'IGR_J17379-3747', 'J0051-72', 'J0051-736', 'J0911', 'J11305', 'J11435', 
            'J1357', 'J1535-571', 'J1550-564', 'J1628-41', 'J16283-4838', 'J1631-478', 'J1659-152', 
            'J1701-462', 'J1719-356', 'J1720-318', 'J1727-203', 'J1745-26', 'J1746-322', 'J1749.4-2807', 
            'J1752-223', 'J1753', 'J1808.4-3658', 'J1813-095', 'J1817-330', 'J1818-245', 'J1820', 
            'J1828-249', 'J1858.6-0814', 'J1957+032', 'LMC X-1', 'LMC X-2', 'LMC X-3', 'Nova Musca', 
            'Sco X-1', 'SMC X-1', 'SMC X-2', 'SMC X-3', 'V4641', '4U 1254-690', '4U 1538-52', '4U 1543-47', 
            '4U 1543-624', '4U 1608-52', '4U 1630-47', '4U 1636-536', '4U 1658-298', '4U 1702-429', 
            '4U 1735-444', '4U 1755-338', '4U 1822-371', '4U 1907+097']        


def get_proper_name(alias: str) -> str:
    '''
    Given a str of a given nickname, return str of its proper name
    (case insensitive but does take into account white space/spaces btw)
    '''
    nickname_map = {}
    for proper_name, nicknames in proper_to_nicknames.items():
        for nick in nicknames:
            key = nick.lower().strip()
            nickname_map[key] = proper_name
    try:
        return(nickname_map[alias.lower().strip()])
    except KeyError:
        raise Exception("Nickname not recognized.")

def get_nicknames(fullname: str) -> list:
    '''
    For a given proper name or nickname str, return the list of nicknames
    '''
    real_name=get_proper_name(fullname)
    nicklist=proper_to_nicknames.get(real_name, ["NAME ERROR"])
    return(proper_to_nicknames[real_name])


def is_xrb(name: str) -> bool:
    '''
    For a given proper name or nickname str, return bool True if XRB
    '''
    real_name=get_proper_name(name)
    return(real_name in xrb_list)

def is_xrb_quick(real_name: str) -> bool:
    '''
    For a given proper name only, return bool True if XRB
    '''
    return(real_name in xrb_list)

def simbad_time():
    '''testing some things with simbad, this definitely doesn't work on some objects (see A0620 not coming up right)'''
    Simbad.add_votable_fields('otype') 
    keys=[]
    fails=[]
    objs=[]
    listo=[]
    for key in proper_to_nicknames.keys():
        try:
            # Try querying the primary name
            result_table = Simbad.query_object(key)
            keys.append(result_table['main_id'][0])
            objs.append(result_table['otype'][0])
            listo.append(key)
        except:
            # If it fails, try the nicknames
            found = False
            listy = get_nicknames(key)
            for i in listy:
                try:
                    result_table = Simbad.query_object(i)
                    keys.append(result_table['main_id'][0])
                    objs.append(result_table['otype'][0])
                    listo.append(key)
                    found = True
                    break  # stop once one nickname succeeds
                except:
                    continue  # try the next nickname
            
            if not found:
                print('failed:', key)
                fails.append(key)
    print(len(keys))
    print(len(set(keys)))
    for i in range(len(keys)):
        print(listo[i])
        print(keys[i])
        print(objs[i])
        print('___')
    print('fails: ',len(fails))
    print(fails)

if __name__ == '__main__':
    
    try:
        get_proper_name(sys.argv[1])
    except:
        alias=input('Look up name:')
        get_nicknames(alias)
    '''
    simbad_time()
    '''